package com.malwaredetection.app.util;

import com.malwaredetection.app.controller.response.DetectionMessageResponse;
import com.malwaredetection.app.enums.DetectionType;
import com.malwaredetection.app.enums.DeviceType;
import com.malwaredetection.app.repository.entity.Detection;
import org.springframework.stereotype.Component;

import java.sql.Timestamp;
import java.time.Instant;
import java.util.List;
import java.util.stream.Collectors;

@Component
public class Filtering {

    public List<DetectionMessageResponse> filter(List<Detection> messages, Instant fromDate, Instant toDate, DeviceType deviceType, String nameOfApp, DetectionType detectionType) {
        messages = fromDate != null ? messages.stream().filter(m -> m.getTime().after(Timestamp.from(fromDate))).collect(Collectors.toList()) : messages;

        messages = toDate != null ? messages.stream().filter(m -> m.getTime().before(Timestamp.from(toDate))).collect(Collectors.toList()) : messages;

        messages = deviceType != null ? messages.stream().filter(m -> m.getDevice().getDeviceType().equals(deviceType)).collect(Collectors.toList()) : messages;

        messages = nameOfApp != null ? messages.stream().filter(m -> m.getNameOfApp().equals(nameOfApp)).collect(Collectors.toList()) : messages;

        messages = detectionType != null ? messages.stream().filter(m -> m.getType().equals(detectionType)).collect(Collectors.toList()) : messages;

        return messages.stream().map(m -> DetectionMessageResponse.builder()
                .deviceUID(m.getDevice().getDeviceUID())
                .time(m.getTime())
                .deviceType(m.getDevice().getDeviceType())
                .nameOfApp(m.getNameOfApp())
                .type(m.getType())
                .build()).collect(Collectors.toList());
    }


}
